---
import Layout from '../layouts/Layout.astro';

// 1. Traemos TODAS las noticias
const noticias = Object.values(import.meta.glob('./noticias/*.md', { eager: true }));

// Ordenamos por fecha
const noticiasOrdenadas = noticias.sort((a, b) => {
    return new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf();
});

// 2. Función Formatear Fecha
const formatearFecha = (fecha) => {
    if (!fecha) return '';
    const opciones = { year: 'numeric', month: 'long', day: 'numeric' };
    return new Date(fecha + 'T12:00:00').toLocaleDateString('es-ES', opciones);
};
---

<Layout titulo="Noticias y Eventos">
    <main class="contenedor seccion">
        <h1 style="text-align: center; margin-bottom: 2rem;">Noticias y Actividades</h1>
        <p style="text-align: center; max-width: 600px; margin: 0 auto 3rem auto;">
            Mantente al día con todo lo que sucede en el Colegio Crismag.
        </p>

        <div class="tarjetas-grid">
            {noticiasOrdenadas.length === 0 && <p>No hay noticias por el momento.</p>}

            {noticiasOrdenadas.map((noticia) => (
                <article class="tarjeta-noticia">
                    <a href={noticia.url} class="tarjeta-enlace">
                        <img src={noticia.frontmatter.image} alt={noticia.frontmatter.title} />
                        <div class="tarjeta-contenido">
                            <p class="fecha">{formatearFecha(noticia.frontmatter.date)}</p>
                            <h4>{noticia.frontmatter.title}</h4>
                            <p>{noticia.frontmatter.description}</p>
                        </div>
                    </a>
                </article>
            ))}
        </div>
    </main>
</Layout>